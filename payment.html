
<form>
  <script src="https://checkout.flutterwave.com/v3.js"></script>
</form>

<script>
     var params = new URLSearchParams(window.location.search);  
    var amount = params.get("amount");
    var email = params.get("email");
    var name = params.get("name");
    var phone = params.get("phone");
    var trnxRef = params.get("tx_ref"); 
    
  window.onload = makePayment;

  function makePayment() {
    FlutterwaveCheckout({
      public_key: "FLWPUBK_TEST-f1ea6f74705ea0373373c18dd8977ccc-X",
      tx_ref: trnxRef,
      amount: amount,
      currency: "NGN",
      payment_options: "card,mobilemoney,ussd",
      customer: {
        email: email,
        phonenumber: phone,
        name: name,
      },
      callback: function (data) { // specified callback function
        fetch("https://knowmynetworkbackend.azurewebsites.net/api/Transactions/SavePaymentFromVendor", {
          method: "POST",
          headers: {"Content-type": "application/json; charset=UTF-8"},
          body: JSON.stringify(data),
        }).then(resp => {
          if(resp.status === 200){
            console.log("payment completed successfully")
          }
          else if(resp.status == 400 || resp.status == 500){
            resp.json(result => console.log(result));
          }
          window.history.pushState("", "", data.status+ "?transaction_id="+ data.transaction_id);
        }).catch(err => console.error(err));
   
      },
      customizations: {
        title: "KMN Test Test",
        description: "Test Payment for rides",
        logo: "https://assets.piedpiper.com/logo.png",
      },
    });
  }
</script>
